{{ ansible_managed | comment }}
---
apiVersion: ais.nvidia.com/v1beta1
kind: AIStore
metadata:
  name: ais
  namespace: {{ cluster }}
spec:
  # Add fields here
  size: {{ cluster_size }}
  configToUpdate:
    rebalance:
      enabled: false
      bundle_multiplier: 2

  enablePromExporter: false
  proxySpec:
    hostPort: 51080
    servicePort: 51080
    portPublic: 51080
    portIntraControl: 51081
    portIntraData: 51082
    capabilities:
      privileged: true

    nodeSelector:
      nvidia.com/ais-proxy: {{ cluster }}
  targetSpec:
    hostPort: 51081
    servicePort: 51081
    portPublic: 51081
    portIntraControl: 51082
    portIntraData: 51083
    capabilities:
      privileged: true

    nodeSelector:
      nvidia.com/ais-target: {{ cluster }}
    mounts:
{% for mpath in ais_mpaths %}
      - path: {{ mpath }}
        size: {{ ais_mpath_size }}
        storageClass: "ais-local-storage"
        selector:
          matchLabels:
            mpath: "pv{{ mpath | replace('/','-') }}"
{% endfor %}

  nodeImage: "{{ node_image }}"
  initImage: "aistorage/ais-init:latest"
  hostpathPrefix: "/etc/ais"
{% if aws_secret_name != "" %}
  awsSecretName: "{{ aws_secret_name }}"
{% endif %}
{% if gcp_secret_name != "" %}
  gcpSecretName: "gcp-creds"
{% endif %}

  # To be able to access the AIS deployment outside kubernetes cluster, set:
  # enableExternalLB: true
  # NOTE: For external access to work, the kubernetes cluster should have the capabilitly to create LoadBalancer services with valid external IP.
  # For local testing with `minikube` run `minikube tunnel` in background for emulation. ref: https://minikube.sigs.k8s.io/docs/commands/tunnel/
  enableExternalLB: false

  clusterDomain: "aiscluster.local"
